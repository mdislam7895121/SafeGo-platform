generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminProfile {
  id        String   @id
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("admin_profiles")
}

model CustomerProfile {
  id                    String            @id
  userId                String            @unique
  fatherName            String?
  presentAddress        String?
  permanentAddress      String?
  nidNumber             String?
  nidFrontImageUrl      String?
  nidBackImageUrl       String?
  homeAddress           String?
  governmentIdType      String?
  governmentIdLast4     String?
  dateOfBirth           DateTime?
  emergencyContactName  String?
  emergencyContactPhone String?
  verificationStatus    String            @default("pending")
  rejectionReason       String?
  isVerified            Boolean           @default(false)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  isSuspended           Boolean           @default(false)
  suspendedAt           DateTime?
  suspensionReason      String?
  district              String?
  fullName              String?
  nidEncrypted          String?
  phoneNumber           String?
  postOffice            String?
  thana                 String?
  village               String?
  user                  User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  deliveries            Delivery[]
  driverComplaints      DriverComplaint[]
  foodOrders            FoodOrder[]
  rides                 Ride[]

  @@map("customer_profiles")
}

model Delivery {
  id               String           @id
  customerId       String
  driverId         String?
  pickupAddress    String
  pickupLat        Float?
  pickupLng        Float?
  dropoffAddress   String
  dropoffLat       Float?
  dropoffLng       Float?
  serviceFare      Decimal          @db.Decimal(10, 2)
  safegoCommission Decimal          @db.Decimal(10, 2)
  driverPayout     Decimal          @db.Decimal(10, 2)
  paymentMethod    String
  status           String
  customerRating   Int?
  customerFeedback String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  deliveredAt      DateTime?
  customer         CustomerProfile  @relation(fields: [customerId], references: [id])
  driver           DriverProfile?   @relation(fields: [driverId], references: [id])

  @@map("deliveries")
}

model DriverComplaint {
  id         String             @id
  driverId   String?
  customerId String?
  rideId     String?
  reason     String
  description String?
  status     String             @default("open")
  resolvedAt DateTime?
  resolvedBy String?
  createdAt  DateTime           @default(now())
  updatedAt  DateTime
  restaurantId String?
  type       String             @default("driver")
  customer   CustomerProfile?   @relation(fields: [customerId], references: [id])
  driver     DriverProfile?     @relation(fields: [driverId], references: [id], onDelete: Cascade)
  restaurant RestaurantProfile? @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  ride       Ride?              @relation(fields: [rideId], references: [id])

  @@map("driver_complaints")
}

model DriverProfile {
  id                    String             @id
  userId                String             @unique
  fatherName            String?
  presentAddress        String?
  permanentAddress      String?
  nidNumber             String?
  nidFrontImageUrl      String?
  nidBackImageUrl       String?
  homeAddress           String?
  governmentIdType      String?
  governmentIdLast4     String?
  driverLicenseNumber   String?
  driverLicenseImageUrl String?
  driverLicenseExpiry   DateTime?
  ssnLast4              String?
  dateOfBirth           DateTime?
  emergencyContactName  String?
  emergencyContactPhone String?
  verificationStatus    String             @default("pending")
  rejectionReason       String?
  isVerified            Boolean            @default(false)
  createdAt             DateTime           @default(now())
  updatedAt             DateTime
  isSuspended           Boolean            @default(false)
  lastActive            DateTime?
  suspendedAt           DateTime?
  suspensionReason      String?
  district              String?
  fullName              String?
  nidEncrypted          String?
  phoneNumber           String?
  postOffice            String?
  thana                 String?
  village               String?
  backgroundCheckDate   DateTime?
  backgroundCheckStatus String?            @default("pending")
  licenseStateIssued    String?
  ssnEncrypted          String?
  usaCity               String?
  usaFullLegalName      String?
  usaPhoneNumber        String?
  usaState              String?
  usaStreet             String?
  usaZipCode            String?
  dmvLicenseImageUrl    String?
  firstName             String?
  lastName              String?
  middleName            String?
  profilePhotoUrl       String?
  tlcLicenseImageUrl    String?
  deliveries            Delivery[]
  driverComplaints      DriverComplaint[]
  user                  User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  driverStats           DriverStats?
  driverWallet          DriverWallet?
  foodOrders            FoodOrder[]
  rides                 Ride[]
  vehicleDocuments      VehicleDocument[]
  vehicle               Vehicle?

  @@map("driver_profiles")
}

model DriverStats {
  id         String        @id
  driverId   String        @unique
  rating     Decimal       @default(5.0) @db.Decimal(3, 2)
  totalTrips Int           @default(0)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime
  driver     DriverProfile @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@map("driver_stats")
}

model DriverWallet {
  id              String        @id
  driverId        String        @unique
  balance         Decimal       @default(0) @db.Decimal(10, 2)
  negativeBalance Decimal       @default(0) @db.Decimal(10, 2)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  driver          DriverProfile @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@map("driver_wallets")
}

model FoodOrder {
  id                String            @id
  customerId        String
  restaurantId      String
  driverId          String?
  deliveryAddress   String
  deliveryLat       Float?
  deliveryLng       Float?
  serviceFare       Decimal           @db.Decimal(10, 2)
  safegoCommission  Decimal           @db.Decimal(10, 2)
  restaurantPayout  Decimal           @db.Decimal(10, 2)
  driverPayout      Decimal           @db.Decimal(10, 2)
  paymentMethod     String
  status            String
  customerRating    Int?
  customerFeedback  String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  deliveredAt       DateTime?
  customer          CustomerProfile   @relation(fields: [customerId], references: [id])
  driver            DriverProfile?    @relation(fields: [driverId], references: [id])
  restaurant        RestaurantProfile @relation(fields: [restaurantId], references: [id])

  @@map("food_orders")
}

model Notification {
  id        String   @id
  userId    String
  type      String
  title     String
  body      String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model RestaurantProfile {
  id                 String             @id
  userId             String             @unique
  restaurantName     String
  address            String
  verificationStatus String             @default("pending")
  rejectionReason    String?
  isVerified         Boolean            @default(false)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  isSuspended        Boolean            @default(false)
  suspendedAt        DateTime?
  suspensionReason   String?
  driverComplaints   DriverComplaint[]
  foodOrders         FoodOrder[]
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurantWallet   RestaurantWallet?

  @@map("restaurant_profiles")
}

model RestaurantWallet {
  id              String            @id
  restaurantId    String            @unique
  balance         Decimal           @default(0) @db.Decimal(10, 2)
  negativeBalance Decimal           @default(0) @db.Decimal(10, 2)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  restaurant      RestaurantProfile @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@map("restaurant_wallets")
}

model Ride {
  id               String            @id
  customerId       String
  driverId         String?
  pickupAddress    String
  pickupLat        Float?
  pickupLng        Float?
  dropoffAddress   String
  dropoffLat       Float?
  dropoffLng       Float?
  serviceFare      Decimal           @db.Decimal(10, 2)
  safegoCommission Decimal           @db.Decimal(10, 2)
  driverPayout     Decimal           @db.Decimal(10, 2)
  paymentMethod    String
  status           String
  customerRating   Int?
  customerFeedback String?
  driverRating     Int?
  driverFeedback   String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  completedAt      DateTime?
  driverComplaints DriverComplaint[]
  customer         CustomerProfile   @relation(fields: [customerId], references: [id])
  driver           DriverProfile?    @relation(fields: [driverId], references: [id])

  @@map("rides")
}

model User {
  id                String             @id
  email             String             @unique
  passwordHash      String
  role              String
  countryCode       String
  isBlocked         Boolean            @default(false)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  adminProfile      AdminProfile?
  customerProfile   CustomerProfile?
  driverProfile     DriverProfile?
  notifications     Notification[]
  restaurantProfile RestaurantProfile?

  @@map("users")
}

model VehicleDocument {
  id           String         @id
  driverId     String
  documentType String
  uploadedAt   DateTime       @default(now())
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  description  String?
  expiresAt    DateTime?
  fileUrl      String
  vehicleId    String?
  driver       DriverProfile  @relation(fields: [driverId], references: [id], onDelete: Cascade)
  vehicle      Vehicle?       @relation(fields: [vehicleId], references: [id])

  @@index([driverId])
  @@index([vehicleId])
  @@map("vehicle_documents")
}

model Vehicle {
  id                String            @id
  driverId          String            @unique
  vehicleType       String
  vehicleModel      String
  vehiclePlate      String
  isOnline          Boolean           @default(false)
  totalEarnings     Decimal           @default(0) @db.Decimal(10, 2)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  notes             String?
  vehicleDocuments  VehicleDocument[]
  driver            DriverProfile     @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@map("vehicles")
}
